---
import BaseLayout from "../layouts/BaseLayout.astro";
import PostCard from "../components/PostCard.astro";
import HeroEffectHost from "../components/hero-effects/HeroEffectHost.astro";
import { heroEffects } from "../config/hero-effects";
import {
  getAllTagsWithCount,
  getPublishedPosts,
  formatTagForPath,
} from "../utils/posts";
import { withLocalePrefix, type SiteLocale } from "../utils/i18n";

const locale: SiteLocale = "zh-CN";
const posts = await getPublishedPosts(locale);
const latestPosts = posts.slice(0, 6);
const tags = (await getAllTagsWithCount(locale)).slice(0, 12);
const featured = posts[0];
const latestPrimary = latestPosts.slice(0, 1);
const latestMore = latestPosts.slice(1);
---

<BaseLayout
  title="DWILL Blog"
  description="极简架构，高级质感，极致性能。A static engineering blog built for speed and long-term maintainability."
>
  <section class="home-intro" aria-label="Homepage intro">
    <p class="home-intro-badge">静态博客系统</p>
    <h1>为长期写作而生的系统底座</h1>
    <p>
      轻量、可迁移、可长期维护。现在部署在 Cloudflare，未来迁移 VPS 仍保持同一套产物与 URL 结构。
    </p>
    <div class="home-intro-actions">
      <a class="header-cta" href="/posts/">开始阅读</a>
      <a class="home-intro-link" href="/about/">查看架构</a>
    </div>
  </section>

  <section class="home-hero-wrap">
    <HeroEffectHost effect={heroEffects.active} />
  </section>

  <div class="home-content-shell">
    <section class="showcase-shell" aria-label="Showcase layout">
      <div class="showcase-head">
        <nav class="showcase-tabs" aria-label="Homepage sections">
          <a class="active" href="/">示例</a>
          <a href="/posts/">文章</a>
          <a href="/tags/">标签</a>
          <a href="/about/">关于</a>
        </nav>
        <div class="showcase-controls">
          <button type="button" aria-label="Neutral theme">中性</button>
        </div>
      </div>
    </section>

    <section class="surface-inline-grid surface-inline-grid-3" aria-label="System overview">
      <article class="surface-card surface-card-fixed">
        <p class="surface-kicker">发布模式</p>
        <h3>静态优先</h3>
        <p>Markdown 为内容源，构建可预测，输出与部署平台解耦。</p>
        <div class="surface-meta-row">
          <span>{posts.length} 篇文章</span>
          <span>{tags.length} 个标签</span>
        </div>
      </article>

      <article class="surface-card surface-card-fixed">
        <p class="surface-kicker">路由策略</p>
        <h3>稳定 URL</h3>
        <p>`/posts/slug/` 与 `/tags/tag/`，面向长期运营保持一致。</p>
      </article>

      <article class="surface-card surface-card-fixed">
        <p class="surface-kicker">运维方式</p>
        <h3>轻量工作流</h3>
        <p>Markdown 写作，提交、构建、部署。无运行时 CMS 依赖。</p>
      </article>
    </section>

    <section class="home-main-grid">
      <div class="home-main-col">
        <section class="section-stack">
          <div class="section-head">
            <h2>最新写作</h2>
            <a href="/posts/">查看全部</a>
          </div>
          <section class="post-list">
            {latestPrimary.map((post) => <PostCard post={post} locale={locale} />)}
          </section>
        </section>
      </div>

      <aside class="home-side-col" aria-label="Highlights">
        {
          featured && (
            <section class="section-stack">
              <div class="section-head">
                <h2>精选</h2>
                <a href={withLocalePrefix(`/posts/${featured.data.translationKey}/`, locale)}>阅读</a>
              </div>
              <section class="post-list">
                <PostCard post={featured} locale={locale} />
              </section>
            </section>
          )
        }
      </aside>
    </section>

    {
      latestMore.length > 0 && (
        <section class="section-stack">
          <div class="section-head">
            <h2>更多文章</h2>
            <a href="/posts/">浏览全部</a>
          </div>
          <section class="post-grid">
            {latestMore.map((post) => <PostCard post={post} locale={locale} />)}
          </section>
        </section>
      )
    }

    {
      tags.length > 0 && (
        <section class="section-stack section-stack-wide">
          <div class="section-head">
            <h2>主题信号</h2>
            <a href="/tags/">探索</a>
          </div>
          <article class="surface-card">
            <ul class="tag-cloud" aria-label="Popular tags">
              {tags.map(([tag, count]) => (
                <li>
                  <a href={`/tags/${formatTagForPath(tag)}/`}>
                    <span>#{tag}</span>
                    <small>{count}</small>
                  </a>
                </li>
              ))}
            </ul>
          </article>
        </section>
      )
    }
  </div>
</BaseLayout>
